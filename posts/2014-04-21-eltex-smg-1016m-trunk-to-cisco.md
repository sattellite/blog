---
tags: cisco, eltex, voip
noedit: true
---

# Настройка транкового соединения между SMG-1016M и Cisco

При работе Eltex SMG-1016M в качестве центральной городской АТС возникла необходимость выпускать вызовы, отличные от местных, через другой SIP шлюз. В качестве альтернативного SIP шлюза выступает Cisco 7200 Voice, соединенная с провайдерами высшего уровня по SIP: MTT, PrimeLink, Ростелеком. Для этого на SMG-1016M надо создать SIP-транк до этой Cisco.

Сейчас будет приведен пример настройки в моей ситуации, с объяснением некоторых моментов.

### Создаем транк группу

Для начала необходимо создать транк группу. В меню выбирается ***Маршрутизация / Транк группы*** и нажимается **"Добавить транковую группу"**. Править ничего не нужно, просто сохраняем ее.

![](/images/smg-cisco-trunk-1.png)

### Создаем транковое направление

В меню выбираем ***Маршрутизация / Транковые направления*** и создаем новое направление, нажав **Добавить транковое направление**. Меняем название для удобства, сохраняем его и заходим в редактирование. Добавляем ранее созданную транковую группу в направлением и жмем **Применить**. Сюда заходить и что-либо редактировать больше не придется.

![](/images/smg-cisco-trunk-2.png)

### Создаем новый номерной план

В ***Системных параметрах*** количество активных планов нумерации увеличиваем на 1. В моем случае ставим 2.

![](/images/smg-cisco-trunk-3.png)

Далее переходим к новому плану нумерации ***Планы нумерации / План нумерации # 1***. Создаем новый префикс нажав **Добавить префикс**. Выставляем тип префикса - *Транковое направление*, а транковое направление - предварительно созданное направление. Сохраняем и переходим в режим редактирования префикса. Добавляем необходимые маски, по которым будем давать разрешение выходить через этот план.

![](/images/smg-cisco-trunk-4.png)

### Создаем SIP интерфейс

В меню выбираем ***Маршрутизация / Интерфейсы SIP*** и создаем новое направление, нажав **Добавить интерфейс SIP**.

Меняем имя интерфейса на удобочитаемое, режим выставляется `SIP`. Транковая группа указывается та, что была ранее создана - `TrunkGroup01`. Номерной план устанавливается тот, что был создан ранее - `NumberPlan#1`. Имя хоста - адрес Cisco, на которую будут отправляться вызовы. Ставим галочку *Доверенная сеть*, точного её функционала не знаю, но сеть у нас точно доверенная. Далее настраиваются кодеки и факсы.

![](/images/smg-cisco-trunk-5.png)

### Создаем новые модификаторы

В меню выбираем ***Внутренние ресурсы / Таблицы модификаторов*** и создаем новую таблицу модификаторов нажав на **Добавить таблицу модификаторов**. Даем ей имя, сохраняем и переходим в режим редактирования. Создаем новый модификатор по маске соответствующий `CdPn`. На вкладке *Модификация общая* устанавливаем план нумерации - `NumberPlan#1`, что говорит о смене номерного плана. На вкладках модификаторов *CdPN* и *CgPN* устанавливаем необходимые модификации. В моем случае для CdPN - удалить пару цифр в начале, а для CgPN - добавить ABC код города, в котором работает SMG.

В таблице модификаторов, которой подчиняются абоненты надо добавить маски для CdPN и тоже выставить, что вызываемый номер надо обрабатывать согласно `NumberPlan#1`.

### Донастраиваем транк группу

Возвращаемся в ***Маршрутизация / Транк группы*** и выбираем для редакирования созданную в самом начале транк группу - `TrunkGroup01`. Устанавливаем ей в состав группы созданный SIP интерфейс - `SIP-to-Cisco`. Запрещаем входящую связь, т.к. через это направление вызовы будут только отправляться. В исходящей связи назначем на модификаторы CdPN и CgPN устанавливаем созданную таблицу модификаторов. Применяем изменения.

![](/images/smg-cisco-trunk-6.png)

Теперь можно сохранить новую конфигурация во FLASH. Вооружиться *PBX трассировками* и пробовать звонить. Если вдруг вызов не пройдет, то можно в полученных трассировках найти причину такой проблемы.
<!--
<hr>
<hr>
<hr>


1. Создать транк группу.

2. Создать транковое направление: сохранить и добавить транковую группу (п.1).

3. Создать интерфейс SIP:
    - режим : SIP
    - транковая группа : созданная группа (п.1)
    - IP адрес : адрес циски

4. Увеличить количество номерных планов в системных параметрах до `+1`.

5. Настроить активированный план нумерации:
    - тип префикса : транковое направление (п.2)
    - транковое направление : созданное транковое направление (п.2)
    - настроить маски для CdPN и CgPN

6. Создать специфичный для направления модификатор в таблице модификаторов

7. Вернуться к транк группе (п.1):
    - включить в ее состав созданный SIP интерфейс(п.3).
    - запретить входящую связь
    - в исходящей связи назначить модификатор (п.6) для CdPN и CgPN
-->


